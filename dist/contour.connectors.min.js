/*! Contour-Data-Connectors - v1.0.1 - 2015-09-11 */
!function(a,b){b["true"]=a,function(){"use strict";function a(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a.prototype.constructor=a}Contour.extend=function(a){for(var b,c=Array.prototype.slice.call(arguments,1),d=0;d<c.length;d++)if(b=c[d])for(var e in b)a[e]=b[e];return a},Contour.extendClass=function(b,c){var d,e=this;return d=b&&b.hasOwnProperty("constructor")?b.constructor:function(){return e.apply(this,arguments)},Contour.extend(d,e,c),a(d,e),b&&Contour.extend(d.prototype,b),d}}(),function(){"use strict";Contour=Contour||{},Contour.connectors=Contour.connectors||{},Contour.Base=function(){},Contour.Base.extend=Contour.extendClass}(),function(){"use strict";Contour.connectors.ConnectorBase=Contour.Base.extend({initialize:function(){},fetch:function(a,b){var c=this;return d3.text(a,function(a){c.parse(a),b&&b.call(c,a)})},getDimensions:function(){if(!this._data.length)return this._headers[0];var a=[],b=this._data[1];return _.each(this._headers,function(c,d){_.isNaN(+b[d].trim())&&a.push(c)},this),a},getMeasures:function(){var a=[],b=this._data[1];return _.each(this._headers,function(c,d){_.isNaN(+b[d].trim())||a.push(c)},this),a},dimension:function(a){return arguments.length?(this._dimension="function"==typeof a?a:this._headers.indexOf(a.toLowerCase().trim()),this):this._headers[this._dimension]},filter:function(a){return this._filterSelector="function"==typeof a?selector:function(b){for(var c in a){var d=this._headers.indexOf(c);if(d>=0&&b[d]!==a[c])return!1}return!0},this},newMeasure:function(a,b){return this._newMeasure={name:a,fn:b,index:this._headers.length},this},_rollup:function(a,b){var c,d={},e=!1,f=this,g=function(a,c){return"function"==typeof b?b.call(f,a,c):a[b]};if(_.each(a,function(a,b){var f=g(a,b);(c=d[f])||(d[f]=c=[]),c.push(a),e=c.length>1}),!e)return a;var h=[],i=[],j=function(a){_.each(a,function(a,c){if(c===b||_.isNaN(+a))i[c]=i[c]||a;else{var d=+a;i[c]=(i[c]||0)+d}})};for(var k in d)i=[],_.each(d[k],j),h.push(i);return h},measure:function(a,b){a=_.isArray(a)?a:[a];var c=function(a){return a.toLowerCase().trim()};return this.data(_.map(a,c),_.map(b,c))},top:function(a){return this._take=a,this},bottom:function(a){return this._take=-a,this},data:function(a,b){a=_.isArray(a)?a:[a];var c=this,d=this._filterSelector?_.filter(c._data,function(a,b){return c._filterSelector.call(c,a,b,c._headers)}):this._data,e=this._newMeasure?_.map(d,function(a,b){var d=a.slice();return d.push(c._newMeasure.fn.call(c,a,b,c._headers)),d}):d,f=this._rollup(e,this._dimension),g=this._getMeasureIndex(a[0]);this._take&&(f.sort(function(a,b){return+b[g]-+a[g]}),f=this._take>0?f.slice(0,this._take):f.slice(this._take));var h=_.map(a,function(a){return c._generateSeries.call(c,a,f,b)});return h},_getMeasureIndex:function(a){return this._newMeasure&&this._newMeasure.name===a?this._newMeasure.index:this._headers.indexOf(a)},_getDimensionIndex:function(a){return this._headers.indexOf(a)},_generateSeries:function(a,b,c){var d=this,e=function(a,b){return"function"==typeof d._dimension?d._dimension.call(d,a,b):a[d._dimension]},f=this._getMeasureIndex(a),g=_.map(b,function(a,b){var g=e(a,b),h=Date.parse(g),i=g==+g?+g:_.isNaN(h)?g:new Date(h),j={x:i,y:_.isNaN(+a[f])?a[f]:+a[f]};if(c){var k=_.map(c,function(a){return d._getMeasureIndex(a)}),l={};_.each(k,function(b,d){l[c[d]]=a[b]}),_.extend(j,l)}return j});return{name:a,data:g}}})}(),function(){"use strict";Contour.connectors.Csv=Contour.connectors.ConnectorBase.extend({constructor:function(a,b){return b="undefined"==typeof b?!0:b,this.parse(a,b),this._dimension=0,this},splitPattern:/,/,parse:function(a,b){if(this._data=[],this._headers=[],a&&a.length){var c=a.split(/\r\n|\r|\n/);this._headers=b?_.map(c.shift().split(this.splitPattern),function(a){return a.toLowerCase().trim()}):_.range(0,c[0].length),_.each(c.filter(function(a){return a.length}),function(a){this._data.push(a.split(this.splitPattern))},this)}}})}(),function(){"use strict";Contour.connectors.Json=Contour.connectors.ConnectorBase.extend({constructor:function(a){return this._dimension=0,this.parse(a),this},parse:function(a){var b=_.keys(a);this._headers=_.map(b,function(a){return a.toLowerCase()})||[],this._data=[];for(var c=0;c<b.length;c++)for(var d=a[b[c]],e=0;e<d.length;e++){var f=this._data[e]||(this._data[e]=[]);f.push(d[e])}}})}(),function(){"use strict";Contour.connectors.Tsv=Contour.connectors.Csv.extend({splitPattern:/\t/})}(),Contour.connectors.version="1.0.1"}({},function(){return this}());
//# sourceMappingURL=contour.connectors.min.js.map